<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patent Path | Institutional IP Portal</title>
    <style>
        :root {
            --brand-dark: #002b5c;
            --brand-primary: #0056b3;
            --brand-light: #3d85c6;
            --brand-gradient: linear-gradient(135deg, #002b5c 0%, #3d85c6 100%);
            --bg-surface: #f4f7fa;
            --text-main: #172b4d;
            --text-muted: #5e6c84;
            --border-color: #dfe1e6;
            --radius: 12px;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-surface); color: var(--text-main); overflow: hidden;
        }

        /* --- Login System --- */
        #login-overlay {
            position: fixed; inset: 0; background: var(--brand-gradient);
            display: flex; justify-content: center; align-items: center; z-index: 10000;
        }
        .login-box {
            background: white; padding: 50px; border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3); width: 420px; text-align: center;
        }
        .login-logo { max-width: 180px; margin-bottom: 20px; }

        .login-box input {
            width: 100%; padding: 14px; margin-bottom: 20px;
            border: 2px solid var(--border-color); border-radius: 6px; box-sizing: border-box;
            background: #fdfdfd;
        }
        .btn-auth {
            width: 100%; padding: 14px; background: var(--brand-primary); color: white;
            border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .btn-auth:hover { background: var(--brand-dark); }

        /* --- Main Layout --- */
        #app-container { display: none; height: 100vh; flex-direction: row; }
        .sidebar {
            width: 300px; background: var(--brand-dark); color: white;
            display: flex; flex-direction: column;
        }
        .sidebar-brand { padding: 30px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-logo { width: 160px; filter: brightness(0) invert(1); }

        .nav-list { flex-grow: 1; padding: 20px 0; overflow-y: auto; }
        .nav-item {
            padding: 14px 20px; cursor: pointer; transition: 0.3s; font-size: 0.9rem;
            display: flex; justify-content: space-between; align-items: center; color: #cbd5e1;
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-item.active { background: var(--brand-light); color: white; font-weight: 600; }

        /* --- Viewport --- */
        .viewport { flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; }
        .header {
            background: white; padding: 20px 40px; border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100;
        }

        .progress-box { width: 300px; }
        .progress-label { font-size: 11px; font-weight: bold; color: var(--text-muted); margin-bottom: 5px; }
        .progress-track { height: 10px; background: #ebecf0; border-radius: 5px; overflow: hidden; }
        #progress-bar { height: 100%; background: var(--brand-gradient); width: 0%; transition: width 0.8s ease; }

        /* --- Content Grid --- */
        .content-grid { display: grid; grid-template-columns: 1.8fr 1fr; gap: 30px; padding: 30px 40px; }
        .card { background: white; border: 1px solid var(--border-color); border-radius: 8px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .card h3 { 
            margin-top: 0; font-size: 0.85rem; color: var(--text-muted); 
            text-transform: uppercase; border-bottom: 1px solid #f4f5f7; 
            padding-bottom: 12px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;
        }

        .vault-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px; background: #fafbfc; border: 1px solid #eee; 
            margin-bottom: 10px; border-radius: 6px; font-size: 0.9rem;
        }

        /* --- Buttons & UI --- */
        .btn { padding: 8px 16px; border-radius: 4px; cursor: pointer; border: none; font-weight: 600; font-size: 0.85rem; transition: 0.2s; }
        .btn-primary { background: var(--brand-primary); color: white; }
        .btn-secondary { background: #ebecf0; color: #42526e; }
        
        .upload-trigger { 
            display: inline-flex; align-items: center; justify-content: center;
            width: 24px; height: 24px; background: var(--brand-primary); 
            color: white; border-radius: 50%; font-size: 18px; line-height: 1; cursor: pointer; 
        }

        #chat-window { display: none; }
        .chat-container { height: 200px; border: 1px solid var(--border-color); border-radius: 4px; padding: 10px; overflow-y: auto; background: #fdfdfd; font-size: 0.85rem; margin-bottom: 10px; }
        .chat-input { display: flex; gap: 5px; }
        .chat-input input { flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 3px; }

        #profile-modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5);
            z-index: 10001; justify-content: center; align-items: center;
        }
        .modal-content { background: white; padding: 30px; border-radius: 8px; width: 450px; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <img src="logo.png" alt="Patent Path Logo" class="login-logo">
            <p style="color: #6b778c; margin-bottom: 30px; font-weight: 500;">Institutional IP Workflow Portal</p>
            <form id="auth-form">
                <input type="email" id="login-email" placeholder="Institutional Email" value="admin@admin.com" required>
                <input type="password" id="login-pass" placeholder="Access Key" value="password123" required>
                <button type="submit" class="btn-auth">AUTHENTICATE</button>
            </form>
            <div style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                <p style="font-size: 11px; color: #777; margin: 0;"><b>Demo Accounts:</b> admin@admin.com | user@user.com</p>
                <p style="font-size: 11px; color: #3d85c6; margin-top: 5px;"><i>Note: Enter any password to login</i></p>
            </div>
        </div>
    </div>

    <div id="app-container">
        <nav class="sidebar">
            <div class="sidebar-brand">
                <img src="logo.png" alt="Patent Path Logo" class="sidebar-logo">
            </div>
            <div class="nav-list" id="sidebar-items"></div>
            <div style="padding: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                <button class="btn btn-secondary" style="width:100%; background: rgba(255,255,255,0.1); color: white; border: none; margin-bottom:10px;" onclick="toggleSettings(true)">Profile Settings</button>
                <button class="btn btn-secondary" style="width:100%; background: transparent; color: var(--brand-light); border: 1px solid var(--brand-light);" onclick="location.reload()">Logout</button>
            </div>
        </nav>

        <main class="viewport">
            <header class="header">
                <div class="progress-box">
                    <div class="progress-label">LIFECYCLE STATUS: <span id="pct-text">0%</span></div>
                    <div class="progress-track"><div id="progress-bar"></div></div>
                </div>
                <div class="toolbar">
                    <button class="btn btn-secondary" style="margin-right: 10px;" onclick="toggleDictionary()">Dictionary</button>
                    <button class="btn btn-primary" id="send-request-btn">Request Milestone Data</button>
                </div>
            </header>

            <div class="content-grid">
                <div class="col-main">
                    <div class="card">
                        <h2 id="view-title" style="margin-top:0; color: var(--brand-dark);">System Home</h2>
                        <p id="view-desc" style="color: var(--text-muted); line-height: 1.6;">Welcome to the updated Patent Roadmap. Select a workflow milestone to manage documents.</p>
                    </div>

                    <div class="card">
                        <h3>Document Vault <span class="upload-trigger" onclick="triggerFileUpload()">+</span></h3>
                        <div id="vault-area">
                            <p style="text-align: center; color: #999; padding: 40px;">Select a milestone to view documents.</p>
                        </div>
                    </div>

                    <div id="chat-window" class="card">
                        <h3>Legal Support Chat</h3>
                        <div class="chat-container" id="chat-box"></div>
                        <div class="chat-input">
                            <input type="text" id="msg-input" placeholder="Query legal officer...">
                            <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                        </div>
                    </div>
                </div>

                <div class="col-side">
                    <div id="dictionary-panel" class="card" style="display: none;">
                        <h3>Legal Dictionary</h3>
                        <p style="font-size: 0.8rem;"><strong>Priority Date:</strong> The date used to establish the novelty of an invention.</p>
                        <p style="font-size: 0.8rem;"><strong>Prior Art:</strong> Any previous disclosure of a similar invention.</p>
                    </div>
                    <div class="card">
                        <h3>Active Profile</h3>
                        <div style="font-size: 0.9rem;">
                            <p><strong>Officer:</strong> <span id="disp-name">Legal Team D03</span></p>
                            <p><strong>Target:</strong> <span id="disp-mail">innovator@dtu.dk</span></p>
                            <p><strong>Patent Jurisdiction:</strong> <span id="disp-jur">EPO</span></p> 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

<div id="profile-modal">
    <div class="modal-content">
        <h2 style="margin-top:0; color:var(--brand-primary);">Officer Profile Settings</h2>
        <div style="margin-bottom:15px;"><label style="display:block; font-size:11px; font-weight:bold; margin-bottom:5px;">Full Name</label><input type="text" id="set-name" value="Legal Team D03" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;"></div>
        
        <div style="margin-bottom:15px;">
            <label style="display:block; font-size:11px; font-weight:bold; margin-bottom:5px;">Patent Jurisdiction</label>
            <select id="set-jur" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;">
                <option value="EPO">EPO (Europe)</option>
                <option value="USPTO">USPTO (USA)</option>
                <option value="DKPT">DKPT (Denmark)</option>
                <option value="WIPO">WIPO (International)</option>
            </select>
        </div>

        <div style="margin-bottom:15px;"><label style="display:block; font-size:11px; font-weight:bold; margin-bottom:5px;">Applicant Email</label><input type="email" id="set-mail" value="innovator@dtu.dk" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;"></div>
        <button class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
        <button class="btn btn-secondary" onclick="toggleSettings(false)">Cancel</button>
    </div>
</div>

   <script>
    // System State & Profile Data
    let currentUser = { email: "", role: "" };
    
    // Updated Profile Object to include Jurisdiction
    let profile = { 
        name: "Legal Team D03", 
        mail: "innovator@dtu.dk",
        jur: "EPO" 
    };

    // Original Patent Roadmap Data
    const patentRoadmap = [
        {
            id: '0', title: '0. Initial Research', pct: 10,
            desc: 'Invention description, variants, sketches, and disclosure history.',
            docs: [
                { name: 'Core Invention Description', owner: 'user' },
                { name: 'Literature Review', owner: 'user' },
                { name: 'Drawings, sketches and diagrams', owner: 'user' }
            ],
            body: "Please submit your core invention description and sketches for initial review."
        },
        {
            id: '1', title: '1. Prior Art Search', pct: 30,
            desc: 'Keywords, essential features, and known existing solutions.',
            docs: [
                { name: 'Keywords and Citations', owner: 'user' },
                { name: 'Database Search Log', owner: 'admin' },
                { name: 'Prior Art Results', owner: 'admin' }
            ],
            body: "We have updated the Prior Art results. Please review the Search Log."
        },
        {
            id: '2', title: '2. Priority Date', pct: 50,
            desc: 'Target priority date and initial drafting.',
            docs: [
                { name: 'Current Claim Draft', owner: 'admin' },
                { name: 'Current Application Form Draft', owner: 'admin' },
                { name: 'Technical Drawings', owner: 'user' }
            ],
            body: "Please submit the final technical drawings for the Priority filing."
        },
        {
            id: '4', title: '4. Filing', pct: 80,
            desc: 'Official submission of application to patent offices.',
            docs: [
                { name: 'Completed Application Form', owner: 'admin' },
                { name: 'Filing Receipts', owner: 'admin' },
                { name: 'Submission Confirmation', owner: 'admin' }
            ],
            body: "Filing completed. Please download your receipts."
        },
        {
            id: '5', title: '5. Examination', pct: 100,
            desc: 'Monitoring patent office responses and approval status.',
            docs: [
                { name: 'Letters from the patent office', owner: 'admin' }
            ],
            body: "A new letter has been received from the patent office."
        }
    ];

    // --- Authentication Logic ---
    document.getElementById('auth-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        
        // Simple role assignment based on demo emails
        currentUser.role = (email === 'admin@admin.com') ? 'admin' : 'user';
        
        // UI Transitions
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('app-container').style.display = 'flex';
        
        // Role-based visibility
        document.getElementById('send-request-btn').style.display = (currentUser.role === 'admin') ? 'block' : 'none';
        document.getElementById('chat-window').style.display = (currentUser.role === 'user') ? 'block' : 'none';
        
        renderSidebar();
        updateUI(); // Initialize display with profile data
    });

    // --- Sidebar & Navigation ---
    function renderSidebar() {
        const list = document.getElementById('sidebar-items');
        list.innerHTML = '';
        patentRoadmap.forEach(stage => {
            const div = document.createElement('div');
            div.className = 'nav-item';
            div.innerHTML = `<span>${stage.title}</span><span style="font-size:10px; opacity:0.5;">${stage.pct}%</span>`;
            div.onclick = () => selectStage(stage, div);
            list.appendChild(div);
        });
    }

    function selectStage(stage, element) {
        // Handle active state UI
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        element.classList.add('active');

        // Update Header & Progress
        document.getElementById('view-title').innerText = stage.title;
        document.getElementById('view-desc').innerText = stage.desc;
        document.getElementById('progress-bar').style.width = stage.pct + '%';
        document.getElementById('pct-text').innerText = stage.pct + '%';

        // Render Vault Documents
        const vault = document.getElementById('vault-area');
        vault.innerHTML = stage.docs.map(doc => {
            const canUpload = (currentUser.role === doc.owner);
            let btnHtml = `<button class="btn btn-secondary" style="font-size: 9px;">VIEW</button>`;
            
            if (canUpload) {
                // Button functionality restored as requested
                btnHtml += `<button class="btn btn-secondary" style="font-size: 9px; border: 1px dashed var(--brand-light);" onclick="triggerFileUpload()">UPLOAD</button>`;
            }
            
            const subLabel = doc.owner === 'user' ? 'Innovator' : 'Admin';
            return `<div class="vault-item">
                <div><span>ðŸ“„ ${doc.name}</span><br><small style="color: #999;">Submit by ${subLabel}</small></div>
                <div style="display:flex; gap: 8px;">${btnHtml}</div>
            </div>`;
        }).join('');

        // Update the Email Request Button Logic
        document.getElementById('send-request-btn').onclick = () => {
            const params = new URLSearchParams({ 
                view: 'cm', 
                fs: '1', 
                to: profile.mail, 
                su: `Patent Update [${profile.jur}]: ${stage.title}`, 
                body: `Dear Partner,\n\nRegarding the ${profile.jur} jurisdiction application: ${stage.body}\n\nRegards,\n${profile.name}` 
            });
            window.open(`https://mail.google.com/mail/?${params.toString()}`, '_blank');
        };
    }

    // --- Profile & Settings Management ---
    function toggleSettings(show) { 
        document.getElementById('profile-modal').style.display = show ? 'flex' : 'none'; 
    }

    function saveSettings() {
        // Pull values from Modal
        profile.name = document.getElementById('set-name').value;
        profile.mail = document.getElementById('set-mail').value;
        profile.jur = document.getElementById('set-jur').value; 
        
        updateUI(); // Refresh the Dashboard labels
        toggleSettings(false);
    }

    function updateUI() {
        // Update Dashboard labels
        document.getElementById('disp-name').innerText = profile.name;
        document.getElementById('disp-mail').innerText = profile.mail;
        document.getElementById('disp-jur').innerText = profile.jur; 
    }

    // --- Utility Functions ---
    function toggleDictionary() {
        const p = document.getElementById('dictionary-panel');
        p.style.display = (p.style.display === 'none') ? 'block' : 'none';
    }

    function sendMessage() {
        const input = document.getElementById('msg-input');
        if (!input.value.trim()) return;
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML += `<div style="margin-bottom:8px;"><strong>You:</strong> ${input.value}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
        input.value = '';
    }

    function triggerFileUpload() {
        const input = document.createElement('input');
        input.type = 'file';
        input.onchange = e => {
            if(e.target.files.length > 0) {
                alert(`File selected for secure upload: ${e.target.files[0].name}`);
            }
        };
        input.click();
    }
</script>
</body>
</html>
